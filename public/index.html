<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AI Study Buddy — Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">
  <header class="bg-white shadow">
    <div class="max-w-5xl mx-auto px-6 py-5 flex items-center justify-between">
      <div>
        <h1 class="text-xl font-bold text-blue-700">AI Study Buddy</h1>
        <p class="text-sm text-gray-600">Upload PDFs or paste text — generate summaries, quizzes, and flashcards.</p>
      </div>
      <div class="text-sm text-gray-500">Local demo</div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-6 space-y-8">
    <section class="bg-white rounded-lg shadow p-6">
      <h2 class="text-2xl font-semibold mb-3">1. Provide Content</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Upload PDF</label>
          <input id="pdfInput" type="file" accept="application/pdf" class="block w-full" />
          <p class="text-xs text-gray-500 mt-2">Upload a PDF and we will extract the text (max ~20MB).</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Paste Text / Transcript</label>
          <textarea id="textInput" rows="8" class="w-full border rounded p-3" placeholder="Or paste lecture notes / transcript / copied text here"></textarea>
          <p class="text-xs text-gray-500 mt-2">If you paste YouTube transcripts, paste them here.</p>
        </div>
      </div>
    </section>

    <section class="bg-white rounded-lg shadow p-6">
      <h2 class="text-2xl font-semibold mb-3">2. Choose Output</h2>
      <div class="flex items-center gap-4">
        <select id="outputType" class="border rounded p-2">
          <option value="">-- Select --</option>
          <option value="summary">Summary</option>
          <option value="quiz">Quiz (MCQs)</option>
          <option value="flashcards">Flashcards</option>
        </select>
        <button id="generateBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Generate</button>
        <div id="loadingIndicator" class="hidden text-sm text-gray-500 ml-3">Processing…</div>
      </div>
    </section>

    <section id="resultCard" class="hidden bg-white rounded-lg shadow p-6">
      <h2 class="text-2xl font-semibold mb-3">Result</h2>
      <pre id="resultOutput" class="whitespace-pre-wrap text-gray-700"></pre>
      <div class="mt-4 flex gap-3">
        <button id="copyBtn" class="px-3 py-2 border rounded text-sm">Copy</button>
        <button id="newBtn" class="px-3 py-2 border rounded text-sm">Start Over</button>
      </div>
    </section>
  </main>

  <footer class="text-center text-xs text-gray-500 py-6">
    © 2025 AI Study Buddy — Demo. Do not upload sensitive/private files.
  </footer>

<script>
  const generateBtn = document.getElementById('generateBtn');
  const pdfInput = document.getElementById('pdfInput');
  const textInput = document.getElementById('textInput');
  const outputSelect = document.getElementById('outputType');
  const resultCard = document.getElementById('resultCard');
  const resultOutput = document.getElementById('resultOutput');
  const loadingIndicator = document.getElementById('loadingIndicator');
  const copyBtn = document.getElementById('copyBtn');
  const newBtn = document.getElementById('newBtn');

  function showError(msg) { alert(msg); }

  function resetUI() {
    resultCard.classList.add('hidden');
    resultOutput.textContent = '';
  }

  copyBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(resultOutput.textContent).then(()=>alert('Copied to clipboard')).catch(()=>alert('Copy failed'));
  });

  newBtn.addEventListener('click', () => {
    resetUI();
    pdfInput.value = '';
    textInput.value = '';
    outputSelect.value = '';
  });

  generateBtn.addEventListener('click', async () => {
    const type = outputSelect.value;
    if (!type) { showError('Please choose an output type.'); return; }

    // If PDF provided -> upload it
    if (pdfInput.files && pdfInput.files.length > 0) {
      const file = pdfInput.files[0];
      if (file.size > 20 * 1024 * 1024) { showError('PDF too large.'); return; }
      const formData = new FormData();
      formData.append('pdf', file);
      formData.append('type', type);

      loadingIndicator.classList.remove('hidden');
      generateBtn.disabled = true;

      try {
        const resp = await fetch('/upload-pdf', { method: 'POST', body: formData });
        const data = await resp.json();
        loadingIndicator.classList.add('hidden');
        generateBtn.disabled = false;
        if (!resp.ok) { showError(data?.error || 'Server error.'); return; }
        resultOutput.textContent = data.output;
        resultCard.classList.remove('hidden');
      } catch (err) {
        loadingIndicator.classList.add('hidden');
        generateBtn.disabled = false;
        console.error(err);
        showError('Network error while uploading PDF.');
      }
      return;
    }

    // Else use pasted text
    const text = (textInput.value || '').trim();
    if (!text) { showError('Please upload a PDF or paste text.'); return; }

    loadingIndicator.classList.remove('hidden');
    generateBtn.disabled = true;

    try {
      const resp = await fetch('/process-text', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ type, text })
      });
      const data = await resp.json();
      loadingIndicator.classList.add('hidden');
      generateBtn.disabled = false;

      if (!resp.ok) { showError(data?.error || 'Server error.'); return; }
      resultOutput.textContent = data.output;
      resultCard.classList.remove('hidden');
    } catch (err) {
      loadingIndicator.classList.add('hidden');
      generateBtn.disabled = false;
      console.error(err);
      showError('Network error while processing text.');
    }
  });
</script>
</body>
</html>
